@{
    // Define o título da página que será exibido no navegador ou usado em layouts.
    ViewData["Title"] = "Estados do Brasil";
}

<div class="container my-5 text-center">
    <!-- Cabeçalho da página -->
    <h2 class="mb-4">Lista de Estados</h2>

    <!-- Elemento HTML onde os estados serão inseridos dinamicamente -->
    <ul id="lista-estados" class="list-unstyled mb-5"></ul>
    <div class="table-responsive">
        <table class="table table-bordered table-striped mx-auto w-75">
            <thead class="table-dark">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Sigla</th>
                    <th scope="col">Nome</th>
                </tr>
            </thead>
            <tbody id="tabela-estados">
             
            </tbody>
        </table>
    </div>
    <!-- Campo de verificação de sigla -->
    <div class="mb-3 w-50 mx-auto">
        <input type="text" id="siglaInput" class="form-control mb-2" placeholder="Digite a sigla do estado (ex: SP)">
        <button class="btn btn-primary w-100" onclick="verificarSigla()">Verificar Estado</button>
        <div id="resultadoVerificacao" class="mt-3"></div>
    </div>

    
</div>

<script>
    async function verificarSigla() {
        const sigla = document.getElementById('siglaInput').value.trim().toUpperCase();
        const resultado = document.getElementById('resultadoVerificacao');

        // Limpa resultado anterior
        resultado.innerHTML = "";

        try {
            const response = await fetch(`/api/estado/${encodeURIComponent(sigla)}`);
            if (!response.ok) {
                const msg = await response.text();
                resultado.innerHTML = `<div class="alert alert-danger">Erro: ${msg}</div>`;
                return;
            }

            const existe = await response.json();

            if (existe) {
                resultado.innerHTML = `<div class="alert alert-success">✅ Estado com sigla <strong>${sigla}</strong> existe.</div>`;
            } else {
                resultado.innerHTML = `<div class="alert alert-danger">❌ Estado com sigla <strong>${sigla}</strong> não encontrado.</div>`;
            }
        } catch (error) {
            console.error(error);
            resultado.innerHTML = `<div class="alert alert-danger">Erro ao verificar estado.</div>`;
        }
    }
</script>

 <script>
        // Função assíncrona que busca os estados da API e os exibe na página
        async function carregarEstados(){
            try{
                // Faz uma requisição HTTP GET para a rota da API /api/estado
                const response = await fetch('/api/estado');

                // Verifica se a resposta foi bem-sucedida (status 200–299)
                if (!response.ok) throw new Error("Erro ao buscar estados");

                // Converte o corpo da resposta (JSON) em um array de objetos
                const estados = await response.json();
                // Atualiza a tabela <tbody>
                const tabela = document.getElementById('tabela-estados');
                tabela.innerHTML = estados.map(e =>
                    `<tr>
                        <th scope="row">${e.id}</th>
                        <td>${e.sigla}</td>
                        <td>${e.nome}</td>
                    </tr>`
                ).join('');

            } catch (error) {
                console.error(error);
                document.getElementById('lista-estados').innerHTML = "<li>Erro ao carregar estados.</li>";
                document.getElementById('tabela-estados').innerHTML = `<tr><td colspan="3">Erro ao carregar estados.</td></tr>`;

            }
        }
    // Executa a função carregarEstados automaticamente quando a página terminar de carregar
    window.onload = carregarEstados;
</script>




